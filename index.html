<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FANTASYAS</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@600;800&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
background:#000;
color:#fff;
font-family:Manrope,sans-serif;
}
.container{
max-width:700px;
margin:80px auto;
padding:20px;
}
.card{
background:rgba(255,255,255,0.06);
border:1px solid rgba(255,255,255,0.12);
padding:20px;
border-radius:14px;
margin-bottom:20px;
}
input,textarea{
width:100%;
padding:12px;
margin:8px 0;
border-radius:10px;
border:1px solid #333;
background:#111;
color:#fff;
}
button{
padding:10px 16px;
border:none;
border-radius:10px;
background:#444;
color:#fff;
cursor:pointer;
font-weight:700;
}
.post{
border:1px solid rgba(255,255,255,0.1);
padding:15px;
border-radius:12px;
margin-bottom:15px;
}
.username{
font-weight:800;
margin-bottom:6px;
}
.search-item{
padding:10px;
border:1px solid #333;
border-radius:10px;
margin:6px 0;
cursor:pointer;
}
</style>
</head>
<body>

<div class="container">

<div id="authBox" class="card">
<h2>Вхід</h2>
<input id="loginNick" placeholder="Псевдонім">
<input id="loginPass" type="password" placeholder="Пароль">
<button id="loginBtn">Увійти</button>
<hr>
<h3>Реєстрація</h3>
<input id="regNick" placeholder="Новий псевдонім">
<input id="regPass" type="password" placeholder="Пароль">
<button id="registerBtn">Зареєструватися</button>
</div>

<div id="app" style="display:none;">

<div class="card">
<textarea id="postText" placeholder="Що у тебе на думці?"></textarea>
<button id="addPost">Опублікувати</button>
</div>

<div class="card">
<input id="searchInput" placeholder="Пошук користувачів...">
<div id="searchResults"></div>
</div>

<div id="feed"></div>

</div>

</div>

<script>
const SUPABASE_URL = "https://cubpfcdnlyznoibvcukh.supabase.co";
const SUPABASE_KEY = "YOUR_ANON_KEY";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser = null;

// РЕЄСТРАЦІЯ
document.getElementById("registerBtn").onclick = async () => {
const nick = regNick.value.trim();
const pass = regPass.value.trim();
if(!nick || !pass) return alert("Заповни поля");

const { data: existing } = await supabase
.from("users")
.select("id")
.eq("nickname", nick)
.single();

if(existing) return alert("Нік зайнятий");

await supabase.from("users").insert([
{ nickname:nick, password:pass }
]);

alert("Готово. Тепер увійди.");
};

// ЛОГІН
document.getElementById("loginBtn").onclick = async () => {
const nick = loginNick.value.trim();
const pass = loginPass.value.trim();

const { data, error } = await supabase
.from("users")
.select("*")
.eq("nickname", nick)
.eq("password", pass)
.single();

if(error || !data) return alert("Невірні дані");

currentUser = data;

authBox.style.display="none";
app.style.display="block";

loadPosts();
};

// ДОДАТИ ПОСТ
document.getElementById("addPost").onclick = async () => {
const text = postText.value.trim();
if(!text) return;

await supabase.from("posts").insert([
{ user_id:currentUser.id, text }
]);

postText.value="";
loadPosts();
};

// ЗАВАНТАЖЕННЯ ПОСТІВ
async function loadPosts(){
feed.innerHTML="";

const { data } = await supabase
.from("posts")
.select("*, users(nickname)")
.order("created_at",{ascending:false});

data.forEach(p=>{
const div=document.createElement("div");
div.className="post";
div.innerHTML=`
<div class="username">@${p.users.nickname}</div>
<div>${p.text}</div>
`;
feed.appendChild(div);
});
}

// ПОШУК
searchInput.oninput = async (e)=>{
const q=e.target.value;
searchResults.innerHTML="";

if(!q) return;

const { data } = await supabase
.from("users")
.select("nickname")
.ilike("nickname",`%${q}%`);

data.forEach(u=>{
const div=document.createElement("div");
div.className="search-item";
div.textContent="@"+u.nickname;
searchResults.appendChild(div);
});
};
</script>

</body>
</html>
